<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mythical Witch Mixes</title>
    <link rel="stylesheet" href="../css/pociones.css">
    <link rel="stylesheet" href="../bootstrap/css/bootstrap.css">
    <!--Enlaces para fuentes de google-->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <!--icono-->
    <link rel="shortcut icon" href="../Assest/ImagenBruja.png" type="image/x-icon">
        <!--enlace para fuente de google-->
    <link href="https://fonts.googleapis.com/css2?family=Koh+Santepheap:wght@100;300;400;700;900&display=swap" rel="stylesheet">
    <style>
        body{
            background-image: url(../Assest/nivel1.jpg); /*Imagen de nivel*/
        }
    </style>
</head>
<body>
    <div class="row col-12 cabeza">
        <div class="retroceso col-4">
           <a href=""><img src="../Assest/fechaRetroceso.png" alt=""></a> 
        </div>
        <div class="tiempo col-5">
            <h1 id="cronometro">2:00</h1>
        </div>
    </div>
    
    <div class="col-12 row">
        <div class="corazones col-4">
            <div class="corazon"><img src="../Assest/corazon.png" alt=""></div>
            <div class="corazon"><img src="../Assest/corazon.png" alt=""></div>
            <div class="corazon"><img src="../Assest/corazon.png" alt=""></div>
        </div>

        <div class="hallar col-5">
            <div class="contenedorHallar">
                <div class="tituloHallar"><h1 class="text-bold">Color objetivo:</h1></div>
                <hr>
                <div class="colorHallar">
                </div>
            </div>
        </div>
    </div>

   <div class="contenedorAbajo">
     <div class="contenedorItem">
        <div class="row" id="botellas">

        </div>
        
     </div>

     <div class="bruja">
        <div class="tamañoBruja" id="arrastreBruja">
            <div class="colorMezcla" id="colorMezcla">
            </div>
        </div>
     </div>  
   </div>
   <!-- <script>
    var colorMezcla =document.getElementById('colorMezcla')
    var botella=document.querySelector('#botellas');
    var colorBruja=document.querySelector('#arrastreBruja');
    var botellaAmarilla=document.querySelector('#botellaAmarilla');
    var botellaAnaranjado=document.querySelector('#botellaAnarajado');
    var botellaVerde=document.querySelector('#botellaVerde');
    var botellaRoja=document.querySelector('#botellaRoja');
    var botellaAzul=document.querySelector('#botellaAzul');

    const imagenes = [
            '<div class="item col-2" id="botellaAmarilla" draggable="true"><img src="../Assest/pocionAmarilla.png" alt=""></div>', '<div class="item col-2" id="botellaAnaranjado" draggable="true"><img src="../Assest/pocionAnaranjado.png" alt=""></div>', '<div class="item col-2" id="botellaVerde" draggable="true"><img src="../Assest/pocionVerde.png" alt=""></div>',
            '<div class="item col-2" id="botellaRoja" draggable="true"><img src="../Assest/pocionRoja.png" alt=""></div>', '<div class="item col-2" id="botellaAzul" draggable="true"><img src="../Assest/pocionMorada.png" alt=""></div>', '<div class="item col-2" id="botellaVerde" draggable="true"><img src="../Assest/pocionVerde.png" alt=""></div>'
        ];
        let print=""
        let terminado = imagenes.length;
    while (imagenes.length) {
            const index = Math.floor(Math.random() * imagenes.length);
            const div = document.createElement('div');
            div.className = 'item col-2';
            div.id = index;
            print += imagenes[index];
            document.getElementById('botellas').innerHTML = print;
            colorBruja.appendChild(div);
            imagenes.splice(index, 1);
        }
        for (let i = 0; i < terminado; i++) {
            const div = document.createElement('div');
            div.className = 'placeholder';
            div.dataset.id = i;
        }



    botella.addEventListener('dragstart', e =>{
        e.dataTransfer.setData('id', e.target.id);
    })
    colorBruja.addEventListener('dragover', e=>{
        e.preventDefault();
        console.log('drag enter')
    });
    
    colorBruja.addEventListener('drop', e=>{
        const id= e.dataTransfer.getData('id')
        let color =  '#daa52061';
        colorMezcla.style.background=color;
       console.log(id)
    });

    /*
    botella.addEventListener('dragstart', e =>{
        console.log('Drag start');
    });
    botella.addEventListener('dragend', e =>{
        console.log('Drag end');
    });
    botella.addEventListener('drag', e =>{
        console.log('Drag');
    });*/


    
   </script>-->
   <script>
    

const imagenes = [
    'pocionAmarilla', 'pocionAnaranjado', 'pocionVerde',
    'pocionRoja', 'pocionMorada'
];


var colorMezcla = document.getElementById('colorMezcla');
var botella = document.querySelector('#botellas');
var colorBruja = document.querySelector('#arrastreBruja');


let colorActual = { r: 255, g: 255, b: 255, a: 1 }; 


function hexToRgba(hex, alpha = 1) {
    const r = parseInt(hex.slice(1, 3), 16);
    const g = parseInt(hex.slice(3, 5), 16);
    const b = parseInt(hex.slice(5, 7), 16);
    return { r, g, b, a: alpha };
}


function rgbaToCss({ r, g, b, a }) {
    return `rgba(${r}, ${g}, ${b}, ${a})`;
}


function mezclarColores(color1, color2) {
    return {
        r: Math.floor((color1.r + color2.r) / 2),
        g: Math.floor((color1.g + color2.g) / 2),
        b: Math.floor((color1.b + color2.b) / 2),
        a: (color1.a + color2.a) / 2
    };
}


function sonColoresIguales(color1, color2) {
    return (
        color1.r === color2.r &&
        color1.g === color2.g &&
        color1.b === color2.b &&
        color1.a === color2.a
    );
}


const colores = {
    'pocionAmarilla': '#ffff00',
    'pocionAnaranjado': '#ffa500',
    'pocionVerde': '#008000',
    'pocionRoja': '#ff0000',
    'pocionMorada': '#000080'
};


const coloresGanadores = [
    { r: 191, g: 63, b: 95, a: 0.4 },  // Color objetivo 1
    { r: 127, g: 63, b: 127, a: 0.4 }  // Color objetivo 2
];


imagenes.forEach(imagen => {
    const div = document.createElement('div');
    div.className = 'item col-2';
    div.id = imagen;
    div.draggable = true;
    div.style.backgroundImage = `url('../Assest/${imagen}.png')`;
    botella.appendChild(div);
});

// Añadir placeholders para la zona de mezcla
imagenes.forEach((_, i) => {
    const div = document.createElement('div');
    div.className = 'placeholder';
    div.dataset.id = i;
    colorBruja.appendChild(div);
});

// Evento para comenzar a arrastrar una botella
botella.addEventListener('dragstart', e => {
    e.dataTransfer.setData('id', e.target.id);
});

// Evento para permitir soltar sobre la zona de mezcla
colorBruja.addEventListener('dragover', e => {
    e.preventDefault();
});

// Evento para gestionar el drop y mezclar colores
colorBruja.addEventListener('drop', e => {
    const id = e.dataTransfer.getData('id');
    const nuevoColorHex = colores[id]; 

    if (nuevoColorHex) {
        // Convertir el color hexadecimal a RGBA
        const nuevoColorRgba = hexToRgba(nuevoColorHex, 0.2); 

        // Mezclar el color actual con el nuevo
        colorActual = mezclarColores(colorActual, nuevoColorRgba);

        // Aplicar el nuevo color mezclado al fondo del elemento "colorMezcla"
        colorMezcla.style.background = rgbaToCss(colorActual); 
        console.log(`ID arrastrado: ${id}, Color aplicado: ${rgbaToCss(colorActual)}`);

        // Verificar si el color resultante es igual a alguno de los colores ganadores
        if (coloresGanadores.some(ganador => sonColoresIguales(colorActual, ganador))) {
            alert('¡GANASTE!');
        }
    }

    let tiempoRestante = 120; // 2 minutos en segundos

const cronometro = document.getElementById('cronometro');

const intervalo = setInterval(() => {
    const minutos = Math.floor(tiempoRestante / 60);
    const segundos = tiempoRestante % 60;

    // Formatear el tiempo
    cronometro.textContent = `${minutos.toString().padStart(2, '0')}:${segundos.toString().padStart(2, '0')}`;

    if (tiempoRestante <= 0) {
        clearInterval(intervalo);
        alert("¡Se acabó el tiempo!");
    } else {
        tiempoRestante--;
    }
}, 1000); // 1000 ms = 1 segundo
});
// Almacena la cantidad de corazones
let corazonesRestantes = 3; // Cambia este número si deseas empezar con más corazones

// Mostrar corazones en la interfaz
function mostrarCorazones() {
    const corazonesContainer = document.querySelector('.corazones');
    corazonesContainer.innerHTML = ''; // Limpiar el contenedor actual
    for (let i = 0; i < corazonesRestantes; i++) {
        const corazonDiv = document.createElement('div');
        corazonDiv.className = 'corazon';
        corazonDiv.innerHTML = '<img src="../Assest/corazon.png" alt="">';
        corazonesContainer.appendChild(corazonDiv);
    }
}

// Llama a esta función al iniciar el juego
mostrarCorazones();

// Evento para gestionar el drop y mezclar colores
colorBruja.addEventListener('drop', e => {
    const id = e.dataTransfer.getData('id');
    const nuevoColorHex = colores[id]; 

    // Verifica si el color seleccionado es válido
    if (nuevoColorHex) {
        const nuevoColorRgba = hexToRgba(nuevoColorHex, 0.2); 
        colorActual = mezclarColores(colorActual, nuevoColorRgba);
        colorMezcla.style.background = rgbaToCss(colorActual); 
        console.log(`ID arrastrado: ${id}, Color aplicado: ${rgbaToCss(colorActual)}`);

        // Verificar si el color resultante es igual a alguno de los colores ganadores
        if (coloresGanadores.some(ganador => sonColoresIguales(colorActual, ganador))) {
            alert('¡GANASTE!');
        } else {
            // Si no se ganó, verifica si la botella es roja o morada
            if (id !== 'pocionRoja' && id !== 'pocionMorada') {
                if (corazonesRestantes > 0) {
                    corazonesRestantes--;
                    mostrarCorazones(); // Actualiza la visualización de corazones
                }
                // Si no hay corazones restantes
                if (corazonesRestantes === 0) {
                    alert("¡No tienes más corazones! Fin del juego.");
                    clearInterval(intervalo); // Detener el cronómetro
                }
            }
        }
    }
});






    /*
    botella.addEventListener('dragstart', e =>{
        console.log('Drag start');
    });
    botella.addEventListener('dragend', e =>{
        console.log('Drag end');
    });
    botella.addEventListener('drag', e =>{
        console.log('Drag');
    });*/

    </script>
    <script src="../js/cronometro.js"></script>
</body>
</html>